    <!doctype html>
    <html lang="ko"><head>
      <meta charset="utf-8"/>
      <meta name="viewport" content="width=device-width,initial-scale=1"/>
      <title>ë‚´ì •ë³´ | JOOLAB</title>
      <link rel="stylesheet" href="/assets/style.css"/>

    </head><body>
      <div class="nav">
        <div class="brand"><span>ğŸ“Š JOOLAB</span><span class="badge">Bigdata Clean</span></div>
        <div class="row" style="gap:8px">
          <div id="who" class="row" style="gap:8px"></div>
          <a class="btn" href="/bigdata.html">ìë£Œ</a>
          <a class="btn" href="/me.html">ë‚´ì •ë³´</a>
          <a class="btn" id="navAdmin" href="/admin.html">ê´€ë¦¬</a>
          <button class="btn" id="btnLogout">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>
      <div class="container">
        <div id="toast" class="notice ok" style="display:none"></div>
        <div class="grid grid2">
  <div class="card">
    <div class="h1">ë‚´ ì •ë³´</div>
    <div id="meBox" class="grid"></div>
    <hr/>
    <div class="h2">ì…ê¸ˆ ê³„ì¢Œ</div>
    <div class="notice">
      <div class="mono" id="acct">ì¹´ì¹´ì˜¤ë±…í¬ 3333-1548-42415 ì´ìŠ¹ë¬¸</div>
      <div class="row" style="margin-top:10px;flex-wrap:wrap">
        <button class="btn" id="btnCopy">ê³„ì¢Œ ë³µì‚¬</button>
        <button class="btn accent" id="btnReq">ì…ê¸ˆí™•ì¸ìš”ì²­</button>
      </div>
      <div class="small" id="reqHint"></div>
    </div>
  </div>
  <div class="card">
    <div class="h1">ë‚´ ê²°ì œë‚´ì—­</div>
    <div id="payBox"></div>
  </div>
</div>
<script>
(async ()=>{
  let me=null;
  try{ me=await JOOLAB.api("/api/me"); }catch(_){ location.href="/login.html"; return; }
  const a=me.access;
  const b=[];
  b.push(`<div class="row" style="flex-wrap:wrap;gap:8px">
    <span class="badge">ì•„ì´ë””: ${JOOLAB.esc(me.user.username)}</span>
    <span class="badge">ìƒíƒœ: ${JOOLAB.esc(a.status)}</span>
    <span class="badge">ë§¤ë‹¬ ê²°ì œì¼: ${JOOLAB.esc(a.bill_day? (a.bill_day+"ì¼") : "-")}</span>
    <span class="badge">ìµœê·¼ ê²°ì œì¼: ${JOOLAB.esc(a.last_paid_at||"-")}</span>
    <span class="badge">ë‹¤ìŒ ê²°ì œì¼: ${JOOLAB.esc((a.next_bill_at||a.active_until)||"-")}</span>
    <span class="badge">ì°¨ë‹¨ì˜ˆì •(+7): ${JOOLAB.esc(a.grace_until||"-")}</span>
  </div>`);
  if(a.status==="BLOCKED") b.push(`<div class="notice danger">ì°¨ë‹¨ ìƒíƒœì…ë‹ˆë‹¤. ê²°ì œ í›„ ì…ê¸ˆí™•ì¸ìš”ì²­ì„ ëˆŒëŸ¬ì£¼ì‹­ì‹œì˜¤.</div>`);
  if(a.status==="GRACE") b.push(`<div class="notice warn">ê²°ì œì¼ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤. ${JOOLAB.esc(a.grace_until||"")} ê¹Œì§€ ê²°ì œê°€ í•„ìš”í•©ë‹ˆë‹¤.</div>`);
  if(a.status==="NO_PAYMENT") b.push(`<div class="notice warn">ê²°ì œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤. ê²°ì œ í›„ ì…ê¸ˆí™•ì¸ìš”ì²­ì„ ëˆŒëŸ¬ì£¼ì‹­ì‹œì˜¤.</div>`);
  $("#meBox").innerHTML=b.join("");

  try{
    const p=await JOOLAB.api("/api/me/payments");
    const rows=p.items||[];
    if(rows.length===0){ $("#payBox").innerHTML=`<div class="notice warn">ê²°ì œë‚´ì—­ ì—†ìŒ</div>`; }
    else{
      const headers=["paid_at","amount","status","memo"];
      const html=JOOLAB.buildTableHtml(headers, rows.map(r=>({paid_at:r.paid_at,amount:JOOLAB.fmt(r.amount),status:r.status,memo:r.memo||""})),
        {category:"me",region:"-",generatedAt:new Date().toLocaleString("ko-KR")});
      $("#payBox").innerHTML=html;
    }
  }catch(e){ $("#payBox").innerHTML=`<div class="notice danger">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${JOOLAB.esc(e.message)}</div>`; }

  $("#btnCopy").addEventListener("click", async ()=>{
    try{ await navigator.clipboard.writeText($("#acct").textContent.trim()); JOOLAB.toast("ë³µì‚¬ ì™„ë£Œ","ok"); }
    catch(e){ JOOLAB.toast("ë³µì‚¬ ì‹¤íŒ¨","danger"); }
  });

  $("#btnReq").addEventListener("click", async ()=>{
    try{
      const amount=prompt("ì…ê¸ˆ ê¸ˆì•¡(ì„ íƒ). ë¹„ìš°ë©´ ê³µë€ìœ¼ë¡œ ìš”ì²­í•©ë‹ˆë‹¤.");
      await JOOLAB.api("/api/deposit/request",{method:"POST",body:JSON.stringify({amount:amount?Number(String(amount).replace(/[^0-9]/g,"")):null})});
      JOOLAB.toast("ìš”ì²­ ì ‘ìˆ˜ ì™„ë£Œ","ok");
      $("#reqHint").textContent="ìš”ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ì í™•ì¸ í›„ ë°˜ì˜ë©ë‹ˆë‹¤.";
    }catch(e){ JOOLAB.toast("ìš”ì²­ ì‹¤íŒ¨: "+e.message,"danger"); }
  });
})();
</script>
      </div>
      <div class="footer small">Â© JOOLAB | ì‹¬í”Œ ìš´ì˜í˜•</div>
      <script src="/assets/app.js"></script>
      <script>JOOLAB.bindAuthUI();</script>
    </body></html>
